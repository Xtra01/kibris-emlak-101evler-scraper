services:
  scraper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: kibris-emlak-scraper
    volumes:
      # Persist data directories
      - ./property_details.csv:/app/property_details.csv
      - ./pages:/app/pages
      - ./listings:/app/listings
      - ./reports:/app/reports
      - ./temp:/app/temp
    environment:
      # Python environment
      - PYTHONUNBUFFERED=1
      # Add any custom environment variables here
      # - CUSTOM_VAR=value
    restart: unless-stopped
    networks:
      - scraper-network
    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
    # Override default command for different operations
    # Uncomment one of the following or override via docker-compose run
    # command: python main.py  # Default scraper
    # command: python extract_data.py  # Run extractor
    # command: python report.py  # Generate reports
    # command: python orchard_analysis.py  # Run orchard analysis
    # command: python generate_agent_report.py  # Generate Word report
    # command: python search.py basic "guzelyurt arsa"  # Search example
    # command: /bin/bash  # Interactive shell

  # Optional: Add a scheduled job service using cron
  scraper-scheduler:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: kibris-emlak-scheduler
    volumes:
      - ./property_details.csv:/app/property_details.csv
      - ./pages:/app/pages
      - ./listings:/app/listings
      - ./reports:/app/reports
      - ./temp:/app/temp
      - ./crontab:/etc/cron.d/scraper-cron:ro
    environment:
      - PYTHONUNBUFFERED=1
    command: >
      sh -c "
      apt-get update && 
      apt-get install -y cron && 
      crontab /etc/cron.d/scraper-cron && 
      cron -f
      "
    restart: unless-stopped
    networks:
      - scraper-network
    profiles:
      - scheduler
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G

networks:
  scraper-network:
    driver: bridge
